var GravitDesigner=function(e){var t={};function o(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(a,r,function(t){return e[t]}.bind(null,r));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=1248)}({1248:function(e,t){PSColor=function(e){this.core=e,this.core.color=this,this.imageColorCache={},this.imageColorCacheHit=0,this.imageColorCacheFail=0},PSColor.BitsReader=function(e,t){if(t.isPSObject(e,"file"))for(this._dataSource=[];!e.isEOF();)this._dataSource.push(e.getUint8());else this._dataSource=e;this._dataIdx=0,this._dataBitsIdx=0},PSColor.BitsReader.prototype._dataSource=null,PSColor.BitsReader.prototype._dataIdx=0,PSColor.BitsReader.prototype._dataBitsIdx=0,PSColor.BitsReader.prototype.rewindData=function(){this._dataIdx=0,this._dataBitsIdx=0},PSColor.BitsReader.prototype.isEOF=function(){return this._dataIdx>=this._dataSource.length},PSColor.BitsReader.prototype.readData=function(e){var t=Math.ceil((e+this._dataBitsIdx)/8);if(this._dataIdx+t<=this._dataSource.length){var o=this._dataSource[this._dataIdx]&255>>this._dataBitsIdx;if(t>1)for(var a=1;a<t;++a)o<<=8,o>>>=0,o+=this._dataSource[this._dataIdx+a];var r=8*t-e-this._dataBitsIdx;return r>0?(o>>=r,this._dataIdx+=t-1,this._dataBitsIdx=8-r):(this._dataIdx+=t,this._dataBitsIdx=0),o}return this._dataIdx=this._dataSource.length,this._dataBitsIdx=0,null},PSColor.prototype.imageColorDecode=function(e,t,o){if(!t){t=[];for(var a=0;a<e.length;a++)t[2*a]=0,t[2*a+1]=1}var r=[];o=o||Math.round(Math.pow(2,8)-1);for(a=0;a<e.length;++a)r[a]=t[2*a]+e[a]*(t[2*a+1]-t[2*a])/o;return r},PSColor.prototype.imageColorProcess=function(e,t,o,a){var r=null;if("CIEBasedABC"==t[0].value){var n=this.pixelHash(e);if(n in this.imageColorCache)return this.imageColorCacheHit++,3!=this.imageColorCache[n].length&&console.log("alyarma"),this.imageColorCache[n].slice();this.imageColorCacheFail++,"[object Array]"===Object.prototype.toString.call(o)&&6==o.length||(o=[0,1,0,1,0,1]),e=this.imageColorDecode(e,o,a),r=this.CIEBasedABCToRGB(e[0],e[1],e[2],t[1].value),this.imageColorCache[n]=r,r=[this.round_clamp_byte(255*r[0]),this.round_clamp_byte(255*r[1]),this.round_clamp_byte(255*r[2])]}else if("DeviceGray"==t[0].value){e=this.imageColorDecode(e,o,a);var l=this.round_clamp_byte(255*e);r=[l,l,l]}else if("DeviceCMYK"==t[0].value)r=this.imageColorDecode(e,o,a),r=[this.round_clamp_byte(255*r[0]),this.round_clamp_byte(255*r[1]),this.round_clamp_byte(255*r[2]),this.round_clamp_byte(255*r[3])];else if("DeviceRGB"==t[0].value)r=this.imageColorDecode(e,o,a),r=[this.round_clamp_byte(255*r[0]),this.round_clamp_byte(255*r[1]),this.round_clamp_byte(255*r[2])];else if("Separation"==t[0].value||"DeviceN"==t[0].value){var i=this.imageColorDecode(e,o,a);r=this._getGColor(t,i).value}else if("Indexed"==t[0].value)if(this.core.classes.isPSObject(t[3],"string")){var u=this.getColorChannelsCount(t[1].value),s=(i=[],t[3].value),c=e[0]<=t[2]?e[0]*u:t[2]*u;c+u>s.length&&(c=s.length-u);for(var h=0;h<u;++h)i.push(s.charCodeAt(c+h));r=this._getGColor(t[1].value,i).value}else r=[255,255,255];return r.slice()},PSColor.prototype.round_clamp_byte=function(e){return Math.min(255,Math.max(0,Math.round(e)))},PSColor.prototype.pixelHash=function(e){for(var t=0,o=0;o<e.length;o++)t=t<<8|e[o];return t},PSColor.prototype.PSColorSpaceChannels={DeviceGray:1,CIEBasedA:1,Separation:1,Pattern:1,Indexed:1,DeviceRGB:3,CIEBasedABC:3,CIEBasedDEF:3,CIEBasedDEFG:4,DeviceCMYK:4,DeviceN:function(e){return e[1].value.length}},PSColor.prototype.getColorChannelsCount=function(e){var t=this.PSColorSpaceChannels[e[0].value];return"function"==typeof t?t(e):t},PSColor.prototype.CIEBasedABCToRGB=function(e,t,o,a){var r,n="object"==typeof a&&"RangeABC"in a?a.RangeABC.value:[0,1,0,1,0,1],l="object"==typeof a&&"RangeLMN"in a?a.RangeLMN.value:[0,1,0,1,0,1];if("object"==typeof a&&"DecodeABC"in a&&(this.core.stack.push(e),a.DecodeABC.value[0].execute(this.core),e=this.core.stack.pop(),this.core.stack.push(t),a.DecodeABC.value[1].execute(this.core),t=this.core.stack.pop(),this.core.stack.push(o),a.DecodeABC.value[2].execute(this.core),o=this.core.stack.pop()),e=(r=this.PSFunctionDomain([e,t,o],n))[0],t=r[1],o=r[2],"object"==typeof a&&"MatrixABC"in a)var i=a.MatrixABC.value,u=e*i[0]+t*i[3]+o*i[6],s=e*i[1]+t*i[4]+o*i[7],c=e*i[2]+t*i[5]+o*i[8];else u=e,s=t,c=o;if("object"==typeof a&&"DecodeLMN"in a&&(this.core.stack.push(u),a.DecodeLMN.value[0].execute(this.core),u=this.core.stack.pop(),this.core.stack.push(s),a.DecodeLMN.value[1].execute(this.core),s=this.core.stack.pop(),this.core.stack.push(c),a.DecodeLMN.value[2].execute(this.core),c=this.core.stack.pop()),u=(r=this.PSFunctionDomain([u,s,c],l))[0],s=r[1],c=r[2],"object"==typeof a&&"MatrixLMN"in a)var h=a.MatrixLMN.value,p=u*h[0]+s*h[3]+c*h[6],v=u*h[1]+s*h[4]+c*h[7],f=u*h[2]+s*h[5]+c*h[8];else p=u,v=s,f=c;return this.XYZToRGB(p,v,f)},PSColor.prototype.XYZToRGBMatrix=[3.241,-.9692,.0556,-1.5374,1.876,-.204,-.4986,.0416,1.057],PSColor.prototype.XYZToRGB=function(e,t,o){return m=this.XYZToRGBMatrix,[e*m[0]+t*m[3]+o*m[6],e*m[1]+t*m[4]+o*m[7],e*m[2]+t*m[5]+o*m[8]]},PSColor.prototype.PSFunctionDomain=function(e,t){var o=e.slice();if(t&&o.length==2*t.length)for(var a=0;a<o.length;a++)o[a]>t[2*a+1]&&(o[a]=t[2*a+1]),o[a]<t[2*a]&&(o[a]=t[2*a]);return o},PSColor.prototype.PSFunctionInterpolate=function(e,t,o,a,r){return Math.abs(o-t)<=1e-10?a:(e-t)*(r-a)/(o-t)+a},PSColor.prototype.PSFunction=function(e,t){if(!("FunctionType"in e.value))return gDevelopment&&(console.log("no FunctionType in dict"),console.log(e)),null;var o=e.value.Domain.value;switch(e.value.FunctionType){case 0:gDevelopment;var a=(g=e.value.Range.value).length/2,r=e.value.DataSource.value,n="Order"in e.value?e.value.Order:1,l=e.value.BitsPerSample,i=e.value.Size.value,u=[],s=i[0];if(i.length>1)for(var c=1;c<i.length;++c)s*=i[c];if(s*=a,"string"==typeof r&&s*l>8*r.length)return null;for(c=0;c<s;++c){var h=c*l,p=Math.floor(h/8),v=h%8,f=Math.ceil((l+v)/8),d=r[p].charCodeAt(0)&255>>v;if(f>1)for(var y=1;y<f;++y)d<<=8,d+=r[p+y].charCodeAt(0);if(l+v<8*f)d>>=8*f-l-v;u.push(d)}var m="Encode"in e.value?e.value.Encode.value:null,C="Decode"in e.value?e.value.Decode.value:null;return t?null:{type:"samples",domain:o,range:g,order:n,encode:m,decode:C,size:i,samples:u,bitsPerSample:l};case 2:var g=!1;"Range"in e.value&&(g=e.value.Range.value);var _=!1;"C0"in e.value&&(_=e.value.C0.value);var M=!1;"C1"in e.value&&(M=e.value.C1.value);var S=!1;if("N"in e.value&&(S=e.value.N),t){if(!_){_=[];for(c=0;c<t.length;c++)_[c]=0}if(!M){M=[];for(c=0;c<t.length;c++)M[c]=1}t=this.PSFunctionDomain(t,o);var b=[];for(c=0;c<t.length;++c)b[c]=_[c]+Math.pow(t,S)*(M[c]-_[c]);return{type:"exp",domain:o,range:g,result:g?this.PSFunctionDomain(b,g):b}}return{type:"exp",C0:_,C1:M,domain:o,range:g};case 3:var x=e.value.Functions.value,P=x.length,D=[];for(c=0;c<P;++c)D.push(this.PSFunction(x[c]));return{type:"stitch",domain:o,bounds:e.value.Bounds.value,encode:m=e.value.Encode.value,stitches:D}}return null},PSColor.prototype._valueDecodeDomain=function(e,t,o,a){return a<=0?e:Math.abs(a-e)<=1e-6?o:Math.abs(e,0)<=1e-6?t:t+e*(o-t)/a},PSColor.prototype._getTenzorPoint=function(e,t,o){var a=1-e[0],r=a*a,n=1-e[1],l=n*n,i=e[0]*e[0],u=e[1]*e[1],s=r*a,c=3*e[0]*r,h=3*i*a,p=i*e[0],v=l*n,f=3*e[1]*l,d=3*u*n,y=u*e[1];o[0]=t[0]*s*v+t[2]*c*v+t[4]*h*v+t[6]*p*v+t[8]*p*f+t[10]*p*d+t[12]*p*y+t[14]*h*y+t[16]*c*y+t[18]*s*y+t[20]*s*d+t[22]*s*f+t[24]*c*f+t[26]*h*f+t[28]*h*d+t[30]*c*d,o[1]=t[1]*s*v+t[3]*c*v+t[5]*h*v+t[7]*p*v+t[9]*p*f+t[11]*p*d+t[13]*p*y+t[15]*h*y+t[17]*c*y+t[19]*s*y+t[21]*s*d+t[23]*s*f+t[25]*c*f+t[27]*h*f+t[29]*h*d+t[31]*c*d},PSColor.prototype._getCoonsPoint=function(e,t,o){var a=1-e[0],r=a*a,n=1-e[1],l=n*n,i=e[0]*e[0],u=e[1]*e[1],s=i*e[0],c=r*a,h=u*e[1],p=l*n,v=c*t[0]+3*r*e[0]*t[22]+3*a*i*t[20]+s*t[18],f=c*t[6]+3*r*e[0]*t[8]+3*a*i*t[10]+s*t[12],d=p*t[0]+3*l*e[1]*t[2]+3*n*u*t[4]+h*t[6],y=p*t[18]+3*l*e[1]*t[16]+3*n*u*t[14]+h*t[12],m=n*v+e[1]*f,C=a*d+e[0]*y,g=n*(a*t[0]+e[0]*t[18])+e[1]*(a*t[6]+e[0]*t[12]);o[0]=m+C-g;var _=c*t[1]+3*r*e[0]*t[23]+3*a*i*t[21]+s*t[19],M=c*t[7]+3*r*e[0]*t[9]+3*a*i*t[11]+s*t[13],S=p*t[1]+3*l*e[1]*t[3]+3*n*u*t[5]+h*t[7],b=p*t[19]+3*l*e[1]*t[17]+3*n*u*t[15]+h*t[13],x=n*_+e[1]*M,P=a*S+e[0]*b,D=n*(a*t[1]+e[0]*t[19])+e[1]*(a*t[7]+e[0]*t[13]);o[1]=x+P-D},PSColor.prototype._interpolateColorBilinearCoons=function(e,t){for(var o=[],a=0;a<t[0].length;++a){var r=t[0][a],n=t[3][a]-t[0][a],l=t[1][a]-t[0][a],i=t[0][a]-t[1][a]-t[3][a]+t[2][a];o.push(Math.max(Math.min(r+n*e[0]+l*e[1]+i*e[0]*e[1],1),0))}return o},PSColor.prototype._interpolateColorBilinearTenzor=function(e,t){for(var o=[],a=0;a<t[0].length;++a){var r=t[0][a],n=t[1][a]-t[0][a],l=t[3][a]-t[0][a],i=t[0][a]-t[1][a]-t[3][a]+t[2][a];o.push(Math.max(Math.min(r+n*e[0]+l*e[1]+i*e[0]*e[1],1),0))}return o},PSColor.prototype._interpolateColorLinear=function(e,t){for(var o=[],a=0;a<t[0].length;++a){var r=t[0][a],n=t[1][a]-t[0][a];o.push(Math.max(Math.min(r+n*e,1),0))}return o},PSColor.prototype._getTriangularPoint=function(e,t,o,a){var r=[];if(r=t[1]>t[3]||t[1]==t[3]&&t[0]>t[2]?[{x:t[2],y:t[3],col:a[1]},{x:t[0],y:t[1],col:a[0]}]:[{x:t[0],y:t[1],col:a[0]},{x:t[2],y:t[3],col:a[1]}],t[5]<r[0].y||t[5]==r[0].y&&t[4]<=r[0].x?r=[{x:t[4],y:t[5],col:a[2]}].concat(r):t[5]<r[1].y||t[5]==r[1].y&&t[4]<=r[1].x?r=[r[0],{x:t[4],y:t[5],col:a[2]},r[1]]:r.push({x:t[4],y:t[5],col:a[2]}),e[1]<=1e-10&&r[0].y<r[1].y)return o[0]=r[0].x,o[1]=r[0].y,r[0].col;if(Math.abs(1-e[1])<=1e-10&&r[2].y>r[1].y)return o[0]=r[2].x,o[1]=r[2].y,r[2].col;var n=r[0].y+e[1]*(r[2].y-r[0].y);o[1]=n;var l=r[0].x+e[1]*(r[2].x-r[0].x),i=this._interpolateColorLinear(e[1],[r[0].col,r[2].col]),u=null;if(n<=r[1].y)if(Math.abs(r[1].y-r[0].y)>1e-10){var s=(n-r[0].y)/(r[1].y-r[0].y),c=r[0].x+s*(r[1].x-r[0].x),h=this._interpolateColorLinear(s,[r[0].col,r[1].col]);l<=c?(o[0]=l+e[0]*(c-l),u=this._interpolateColorLinear(e[0],[i,h])):u=this._interpolateColorLinear(e[0],[h,i])}else o[0]=r[0].x<r[1].x?r[0].x+e[0]*(r[1].x-r[0].x):r[1].x+e[0]*(r[0].x-r[1].x),u=this._interpolateColorLinear(e[0],r[0].x<r[1].x?[r[0].col,r[1].col]:[r[1].col,r[0].col]);else if(Math.abs(r[2].y-r[1].y)>1e-10){s=(n-r[1].y)/(r[2].y-r[1].y),c=r[1].x+s*(r[2].x-r[1].x),h=this._interpolateColorLinear(s,[r[1].col,r[2].col]);l<=c?(o[0]=l+e[0]*(c-l),u=this._interpolateColorLinear(e[0],[i,h])):u=this._interpolateColorLinear(e[0],[h,i])}else o[0]=r[1].x<r[2].x?r[1].x+e[0]*(r[2].x-r[1].x):r[2].x+e[0]*(r[1].x-r[2].x),u=this._interpolateColorLinear(e[0],r[1].x<r[2].x?[r[1].col,r[2].col]:[r[2].col,r[1].col]);return u},PSColor.prototype._apprColor=function(e,t,o,a,r,n){var l,i,u=o-t;return u<=1?n[a][r]:(e?(l=(r-t)/u,i=[n[a][t],n[a][o]]):(l=(a-t)/u,i=[n[t][r],n[o][r]]),this._interpolateColorLinear(l,i))},PSColor.prototype._getApproximatedColor=function(e,t,o,a){for(var r=null,n=null,l=null,i=null,u=o[e][t],s=e-1;s>=0;--s)if(a[s][t]){r=s;break}for(s=e+1;s<a.length;++s)if(a[s][t]){n=s;break}for(var c=t-1;c>=0;--c)if(a[e][c]){l=c;break}for(c=t+1;c<a[e].length;++c)if(a[e][c]){i=c;break}var h=null,p=null;return null==r||null==n?null==l||null==i?(null!=r?h=e-r:null!=n&&(h=n-e),null!=l?p=t-l:null!=i&&(p=i-t),null!=p&&null!=h?u=p<=h?null!=l?o[e][l]:o[e][i]:null!=r?o[r][t]:o[n][t]:null!=p?u=null!=l?o[e][l]:o[e][i]:null!=h&&(u=null!=r?o[r][t]:o[n][t])):(p=i-l,u=this._apprColor(!0,l,i,e,t,o)):(h=n-r,u=null!=l&&null!=i&&(p=i-l)<=h?this._apprColor(!0,l,i,e,t,o):this._apprColor(!1,r,n,e,t,o)),u},PSColor.prototype._getSeparationColorVal=function(e,t,o){this.core.stack=this.core.stack.concat(o),this.core.execstack.push(t),t.execute(this.core),this.core.execstack.pop();var a=this.getColorChannelsCount(e),r=this.core.stack.slice(this.core.stack.length-a);return this.core.stack=this.core.stack.splice(0,this.core.stack.length-a),r},PSColor.prototype._getGColor=function(e,t){var o=this;if("DeviceGray"==e[0].value)return{type:"rgb",value:[this.round_clamp_byte(255*t[0]),this.round_clamp_byte(255*t[0]),this.round_clamp_byte(255*t[0])]};if("DeviceCMYK"==e[0].value)return{type:"cmyk",value:[this.round_clamp_byte(255*t[0]),this.round_clamp_byte(255*t[1]),this.round_clamp_byte(255*t[2]),this.round_clamp_byte(255*t[3])]};if("DeviceRGB"==e[0].value)return{type:"rgb",value:[this.round_clamp_byte(255*t[0]),this.round_clamp_byte(255*t[1]),this.round_clamp_byte(255*t[2])]};if("Pattern"==e[0].value){var a=null;if("PatternType"in t.value&&2==t.value.PatternType&&"Shading"in t.value?a=t.value.Shading:"ShadingType"in t.value&&(a=t),a){var r=!1,n=a.value.ShadingType,l=!1,i=!1,u="string"==typeof a.value.ColorSpace.value?a.value.ColorSpace.value:a.value.ColorSpace.value[0].value;if("Function"in a.value){var s=a.value.Function;if(this.core.classes.isPSObject(s,"array")){if(l=this.PSFunction(s.value[0])){i=[l];for(var c=1;c<s.value.length;++c)i.push(this.PSFunction(s.value[c]))}if(!i||!("DeviceRGB"==u&&3==i.length||"DeviceCMYK"==u&&4==i.length||"DeviceGray"==u&&1==i.length))return this.core.toGravit("error",["01"]),{type:"rgb",value:[0,0,255]};r=!0}else l=this.PSFunction(s)}var h=function(e){var t=null;if(3==e.length&&"DeviceRGB"==u)t={type:"rgb",value:[this.round_clamp_byte(255*e[0]),this.round_clamp_byte(255*e[1]),this.round_clamp_byte(255*e[2])]};else if(4==e.length&&"DeviceCMYK"==u)t={type:"cmyk",value:[this.round_clamp_byte(255*e[0]),this.round_clamp_byte(255*e[1]),this.round_clamp_byte(255*e[2]),this.round_clamp_byte(255*e[3])]};else if(1==e.length&&"DeviceGray"==u)t={type:"rgb",value:[this.round_clamp_byte(255*e[0]),this.round_clamp_byte(255*e[0]),this.round_clamp_byte(255*e[0])]};else if(("DeviceN"==u||"Separation"==u)&&4==a.value.ColorSpace.value.length){var o=a.value.ColorSpace.value,r="string"==typeof o[2].value?[o[2]]:o[2].value,n=o[3],l=this._getSeparationColorVal(r,n,e);return this._getGColor(r,l)}return t}.bind(this),p=function(e,t,o,a,r,n){for(var l=!1,i=0;i<t;++i){if(null===(Se=o.readData(a))){l=!0;break}var u=this._valueDecodeDomain(Se,r[H+2*i],r[H+2*i+1],n);e.push(u)}return l}.bind(this),v=function(e,t,a,n,l,i){var s=e.encode?e.encode:null,c=[];if("exp"==t.type){var p=null;if(null!=t.C0)p=r?t.C0:h(t.C0);else{var v=null!=t.C1?t.C1[0]:1,f=(s?s[2*l]:0)*v,d=o.PSFunctionDomain([f],t.range);p=r?d:h(d)}var y=Math.abs(e.domain[1]-e.domain[0])<=1e-10?l/i:(a-e.domain[0])/(e.domain[1]-e.domain[0]);if(c.push({opacity:1,color:p,position:y}),l==i-1){if(p=null,null!=t.C1)p=r?t.C1:h(t.C1);else{var m=null!=t.C0?t.C0[0]:0,C=m+(s?s[2*l+1]:1)*(1-m);d=o.PSFunctionDomain([C],t.range);p=r?d:h(d)}c.push({opacity:1,color:p,position:1})}}else if("samples"==t.type&&1==t.size.length){var g=t.range.length/2;if(r||"DeviceRGB"==u&&3==g||"DeviceCMYK"==u&&4==g||"DeviceGray"==u&&1==g){var _=t.samples,M=Math.floor(_.length/g),S=t.decode?t.decode:t.range,b=t.encode?t.encode:[0,M-1];if(S.length==2*g)if(M>1){var x=[],P=Math.abs(e.domain[1]-e.domain[0])<=1e-10?l/i:(a-e.domain[0])/(e.domain[1]-e.domain[0]),D=Math.abs(e.domain[1]-e.domain[0])<=1e-10?(l+1)/i:(n-e.domain[0])/(e.domain[1]-e.domain[0]),B=Math.min(P,D),T=Math.max(P,D);if(s)var F=Math.min(s[2*l],s[2*l+1]),k=Math.max(s[2*l],s[2*l+1]);for(var G=0;G<M-1;++G){s?(y=o.PSFunctionInterpolate(G,b[0],b[1],F,k),y=o.PSFunctionInterpolate(y,s[2*l],s[2*l+1],B,T)):y=o.PSFunctionInterpolate(G,b[0],b[1],B,T);d=[];for(var I=G*g,R=0;R<g;++R){var A=_[I+R];A=o.PSFunctionInterpolate(A,0,Math.pow(2,t.bitsPerSample)-1,S[2*R],S[2*R+1]),d.push(A)}d=o.PSFunctionDomain(d,t.range),p=r?d:h(d),x.push({color:p,position:y})}if(l==i-1){for(I=(M-1)*g,d=[],R=0;R<g;++R){A=_[I+R];A=o.PSFunctionInterpolate(A,0,Math.pow(2,t.bitsPerSample)-1,S[2*R],S[2*R+1]),d.push(A)}d=o.PSFunctionDomain(d,t.range),p=r?d:h(d),s?(y=o.PSFunctionInterpolate(M,b[0],b[1],F,k),y=o.PSFunctionInterpolate(y,s[2*l],s[2*l+1],B,T)):y=o.PSFunctionInterpolate(M,b[0],b[1],B,T),x.push({color:p,position:y})}if(r)c=x;else{x.length>2&&(x=o._optimizeStops(x));for(R=0;R<x.length;++R)c.push({opacity:1,color:x[R].color,position:x[R].position})}}else if(1==M){for(y=l==i-1?1:Math.abs(e.domain[1]-e.domain[0])<=1e-10?l/i:(a-e.domain[0])/(e.domain[1]-e.domain[0]),d=[],R=0;R<g;++R){A=_[R];A=o.PSFunctionInterpolate(A,0,Math.pow(2,t.bitsPerSample)-1,S[2*R],S[2*R+1]),d.push(A)}d=o.PSFunctionDomain(d,t.range),p=r?d:h(d),c.push({opacity:1,color:p,position:y})}}}return c};if(2==n||3==n){var f=a.value.Coords,d={type:"rgb",value:[255,255,255]},y={type:"rgb",value:[0,0,0]},m=[{opacity:1,color:d,position:0},{opacity:1,color:y,position:1}];if(!l)return{type:2==n?"linear":"radial",value:f.value,stops:m,transform:t.value.gstate.CTM};if(l.C0&&l.C1)m=[{opacity:1,color:d=h(l.C0),position:0},{opacity:1,color:y=h(l.C1),position:1}];else if("samples"==l.type&&1==l.size.length||"exp"==l.type){var C=[];if(i){for(var g=[],_=0,M=!1,S=0;S<i.length&&!M;++S){var b=i[S],x=v(b,b,b.domain[0],b.domain[1],0,1);!_&&x&&x.length?_=x.length:x.length&&_==x.length||(M=!0),g.push(x)}if(M)return{type:2==n?"linear":"radial",value:f.value,stops:m,transform:t.value.gstate.CTM};for(S=0;S<_;++S){var P=[];for(c=0;c<g.length;++c)P.push(g[c][S].color);var D=g[0][S].position,B=h(P);C.push({opacity:1,color:B,position:D})}C.length>2&&(C=this._optimizeStops(C))}else C=v(l,l,l.domain[0],l.domain[1],0,1);C.length&&(m=C)}else if("stitch"==l.type&&l.stitches.length==(l.bounds?l.bounds.length+1:1)&&2*l.stitches.length==l.encode.length){C=[];for(var T,F=l.domain[0],k=0;k<l.stitches.length;++k){T=F,F=l.bounds&&k<l.bounds.length?l.bounds[k]:l.domain[1];var G=v(l,l.stitches[k],T,F,k,l.stitches.length);if(G&&G.length)for(S=0;S<G.length;++S)C.push(G[S])}C.length&&(m=C)}return{type:2==n?"linear":"radial",value:f.value,stops:m,transform:t.value.gstate.CTM}}if(4==n||5==n){gDevelopment&&console.log("shadingType = "+n),"DeviceRGB"==u?Ce=3:"DeviceCMYK"==u?Ce=4:"DeviceGray"==u&&(Ce=1);for(var I=new PSColor.BitsReader(a.value.DataSource,this.core.classes),R=-1,A=null,w=null,L=null,j=null,E=t.value.BitsPerComponent,O=Math.pow(2,E)-1,N=t.value.BitsPerCoordinate,Y=t.value.BitsPerFlag,z=t.value.Decode.value.slice(),K=Math.pow(2,N)-1,H=(t.value.Function,M=!1,4),V=[],X=[],Z=5==n?t.value.VerticesPerRow:null,U=function(){var e=I.readData(N);if(null===e)return!1;A.push(this._valueDecodeDomain(e,z[0],z[1],K));var o=I.readData(N);if(null===o)return!1;if(A.push(this._valueDecodeDomain(o,z[2],z[3],K)),"Function"in t.value);else{var a=[];if(M=p(a,Ce,I,E,z,O))return!1;L.push(a)}return!0};!I.isEOF()&&!M;)if(4==n){if(null===(R=I.readData(Y)))break;switch(R&=3){case 0:ge=6,be=3;break;case 1:case 2:ge=2,be=1;break;default:return this.core.toGravit("error",["01"]),{type:"rgb",value:[0,0,255]}}if(!(0==R||A&&L)){M=!0;break}if(w=0==R?null:A,A=[],j=0==R?null:L,L=[],M=!U())break;if(be>1)for(k=1;k<be&&!M;++k){if(null===(R=I.readData(Y))){M=!0;break}M=0!=(R&=3)||!U()}if(M)break;1==R?(A=w.slice(2,6).concat(A),L=j.slice(1,3).concat(L)):2==R&&(A=w.slice(4,6).concat(w.slice(0,2)).concat(A),L=[j[2],j[0]].concat(L)),V.push({coords:A,colors:L}),X.push([Math.min(A[0],A[2],A[4]),Math.min(A[1],A[3],A[5]),Math.max(A[0],A[2],A[4]),Math.max(A[1],A[3],A[5])])}else{if(A)w=A,A=[],j=L,L=[];else{A=[],L=[];for(k=0;k<Z&&!M;++k)M=!U();if(M)break}w=A,A=[],j=L,L=[];for(k=0;k<Z&&!M;++k)M=!U();if(M)break;for(k=0;k<Z-1;++k){var q=w.slice(2*k,2*(k+2)).concat(A.slice(2*k,2*(k+1))),J=j.slice(k,k+2).concat([L[k]]);V.push({coords:q,colors:J}),X.push([Math.min(q[0],q[2],q[4]),Math.min(q[1],q[3],q[5]),Math.max(q[0],q[2],q[4]),Math.max(q[1],q[3],q[5])]),q=w.slice(2*(k+1),2*(k+2)).concat(A.slice(2*k,2*(k+2))),J=[j[k+1]].concat(L.slice(k,k+2)),V.push({coords:q,colors:J}),X.push([Math.min(q[0],q[2],q[4]),Math.min(q[1],q[3],q[5]),Math.max(q[0],q[2],q[4]),Math.max(q[1],q[3],q[5])])}}var Q=[],W=[],$=null,ee=null,te=null,oe=null;if(De=t.value.gstate.CTM?t.value.gstate.CTM:null){(Be=[]).push(PSCTM.prototype.transform(z[0],z[2],De)),Be.push(PSCTM.prototype.transform(z[1],z[2],De)),Be.push(PSCTM.prototype.transform(z[0],z[3],De)),Be.push(PSCTM.prototype.transform(z[1],z[3],De)),ee=$=Be[0].x,oe=te=Be[0].y;for(S=1;S<Be.length;++S){(Te=Be[S].x)<$&&($=Te),Te>ee&&(ee=Te),(Fe=Be[S].y)<te&&(te=Fe),Fe>oe&&(oe=Fe)}}else z[0]<z[1]?($=z[0],ee=z[1]):($=z[1],ee=z[0]),z[3]>z[2]?(te=z[2],oe=z[3]):(te=z[3],oe=z[2]);var ae=Math.round(ee-$),re=Math.round(oe-te);if(!ae||!re)return this.core.toGravit("error",["01"]),{type:"rgb",value:[0,0,255]};var ne=[];for(c=0;c<Ce;++c)ne.push(1);for(var le=0;le<re;++le){Q[le]=[],W[le]=[];for(k=0;k<ae;++k)Q[le][k]=ne.slice(),W[le][k]=0}for(c=0;c<X.length;++c){var ie=X[c],ue=(f=V[c].coords,L=V[c].colors,ie[0]),se=ie[2],ce=ie[1],he=ie[3];if(De){(Be=[]).push(PSCTM.prototype.transform(ie[0],ie[1],De)),Be.push(PSCTM.prototype.transform(ie[0],ie[3],De)),Be.push(PSCTM.prototype.transform(ie[2],ie[1],De)),Be.push(PSCTM.prototype.transform(ie[2],ie[3],De)),se=ue=Be[0].x,he=ce=Be[0].y;for(S=1;S<Be.length;++S){(Te=Be[S].x)<ue&&(ue=Te),Te>se&&(se=Te),(Fe=Be[S].y)<ce&&(ce=Fe),Fe>he&&(he=Fe)}}var pe=Math.round(se-ue),ve=Math.round(he-ce);if(pe&&ve){var fe=1/(ke=Math.max(pe,ve)),de=[0,0];for(D=[0,0],le=0;le<=ke;++le)for(k=0;k<=ke;++k){de[0]=k*fe,de[1]=le*fe;var ye=this._getTriangularPoint(de,f,D,L);De?(Re=(D[0]-z[0])/(z[1]-z[0])*ae-.5,Ae=(D[1]-z[2])/(z[3]-z[2])*re-.5):(Ae=D[1]-z[2]-.5,Re=D[0]-z[0]-.5),Ge=Math.max(Math.min(Math.round(Ae),re-1),0),Ie=Math.max(Math.min(Math.round(Re),ae-1),0),Q[Ge][Ie]=ye,W[Ge][Ie]=1}}}var me=[];for(le=0;le<re;++le)for(k=0;k<ae;++k){we=W[le][k]?Q[le][k]:this._getApproximatedColor(le,k,Q,W),xe=h(we);for(c=0;c<Ce;++c)me.push(xe.value[c])}return{type:"imageData",value:me,colorSpace:u,meshType:n,width:ae,height:re,transform:PSCTM.prototype.multiply([(z[1]-z[0])/ae,0,0,(z[3]-z[2])/re,z[0],z[2]],t.value.gstate.CTM)}}if(6==n||7==n){var Ce;gDevelopment&&console.log("shadingType = "+n),"DeviceRGB"==u?Ce=3:"DeviceCMYK"==u?Ce=4:"DeviceGray"==u&&(Ce=1);var ge;for(I=new PSColor.BitsReader(a.value.DataSource,this.core.classes),R=-1,A=null,w=null,L=null,j=null,E=t.value.BitsPerComponent,O=Math.pow(2,E)-1,N=t.value.BitsPerCoordinate,Y=t.value.BitsPerFlag,z=t.value.Decode.value.slice(),K=Math.pow(2,N)-1,t.value.Function,M=!1,H=4,V=[],X=[];!I.isEOF()&&!M&&null!==(R=I.readData(Y));){switch(R&=3){case 0:ge=6==n?24:32;break;case 1:case 2:case 3:ge=6==n?16:24;break;default:return this.core.toGravit("error",["01"]),{type:"rgb",value:[0,0,255]}}if(!(0==R||A&&L)){M=!0;break}var _e,Me;w=0==R?null:A,A=[];for(k=0;k<ge;++k){var Se=I.readData(N);if(null===Se){M=!0;break}k%2==0?(_e=z[0],Me=z[1]):(_e=z[2],Me=z[3]),A.push(this._valueDecodeDomain(Se,_e,Me,K))}if(M)break;if(j=0==R?null:L,L=[],"Function"in t.value);else{var be=0==R?4:2;for(k=0;k<be;++k){var xe=[];for(le=0;le<Ce;++le){if(null===(Se=I.readData(E))){M=!0;break}var Pe=this._valueDecodeDomain(Se,z[H+2*le],z[H+2*le+1],O);xe.push(Pe)}L.push(xe)}}if(M)break;1==R?(A=w.slice(6,14).concat(A),L=j.slice(1,3).concat(L)):2==R?(A=w.slice(12,20).concat(A),L=j.slice(2,4).concat(L)):3==R&&(A=w.slice(18,24).concat(w.slice(0,2)).concat(A),L=[j[3],j[0]].concat(L)),V.push({flag:R,coords:A,colors:L}),X.push([Math.min(A[0],A[6],A[18],A[12]),Math.min(A[1],A[19],A[7],A[13]),Math.max(A[0],A[6],A[18],A[12]),Math.max(A[1],A[19],A[7],A[13])])}var De;Q=[],W=[],$=null,ee=null,te=null,oe=null;if(De=t.value.gstate.CTM?t.value.gstate.CTM:null){(Be=[]).push(PSCTM.prototype.transform(z[0],z[2],De)),Be.push(PSCTM.prototype.transform(z[1],z[2],De)),Be.push(PSCTM.prototype.transform(z[0],z[3],De)),Be.push(PSCTM.prototype.transform(z[1],z[3],De)),ee=$=Be[0].x,oe=te=Be[0].y;for(S=1;S<Be.length;++S){(Te=Be[S].x)<$&&($=Te),Te>ee&&(ee=Te),(Fe=Be[S].y)<te&&(te=Fe),Fe>oe&&(oe=Fe)}}else z[0]<z[1]?($=z[0],ee=z[1]):($=z[1],ee=z[0]),z[3]>z[2]?(te=z[2],oe=z[3]):(te=z[3],oe=z[2]);ae=Math.round(ee-$),re=Math.round(oe-te);if(!ae||!re)return this.core.toGravit("error",["01"]),{type:"rgb",value:[0,0,255]};for(ne=[],c=0;c<Ce;++c)ne.push(1);for(le=0;le<re;++le){Q[le]=[],W[le]=[];for(k=0;k<ae;++k)Q[le][k]=ne.slice(),W[le][k]=0}for(c=0;c<X.length;++c){ie=X[c],f=V[c].coords,L=V[c].colors,ue=ie[0],se=ie[2],ce=ie[1],he=ie[3];if(De){var Be;(Be=[]).push(PSCTM.prototype.transform(ie[0],ie[1],De)),Be.push(PSCTM.prototype.transform(ie[0],ie[3],De)),Be.push(PSCTM.prototype.transform(ie[2],ie[1],De)),Be.push(PSCTM.prototype.transform(ie[2],ie[3],De)),se=ue=Be[0].x,he=ce=Be[0].y;for(S=1;S<Be.length;++S){var Te,Fe;(Te=Be[S].x)<ue&&(ue=Te),Te>se&&(se=Te),(Fe=Be[S].y)<ce&&(ce=Fe),Fe>he&&(he=Fe)}}pe=Math.round(se-ue),ve=Math.round(he-ce);if(pe&&ve){var ke,Ge,Ie,Re,Ae;for(fe=1/(ke=Math.max(pe,ve)),de=[0,0],D=[0,0],le=0;le<=ke;++le)for(k=0;k<=ke;++k)de[0]=k*fe,de[1]=le*fe,6==n?this._getCoonsPoint(de,f,D):this._getTenzorPoint(de,f,D),De?(Re=(D[0]-z[0])/(z[1]-z[0])*ae-.5,Ae=(D[1]-z[2])/(z[3]-z[2])*re-.5):(Ae=D[1]-z[2]-.5,Re=D[0]-z[0]-.5),Ge=Math.max(Math.min(Math.round(Ae),re-1),0),Ie=Math.max(Math.min(Math.round(Re),ae-1),0),Q[Ge][Ie]=6==n?this._interpolateColorBilinearCoons(de,L):this._interpolateColorBilinearTenzor(de,L),W[Ge][Ie]=1}}var we;for(me=[],le=0;le<re;++le)for(k=0;k<ae;++k){we=W[le][k]?Q[le][k]:this._getApproximatedColor(le,k,Q,W),xe=h(we);for(c=0;c<Ce;++c)me.push(xe.value[c])}return{type:"imageData",value:me,colorSpace:u,meshType:n,width:ae,height:re,transform:PSCTM.prototype.multiply([(z[1]-z[0])/ae,0,0,(z[3]-z[2])/re,z[0],z[2]],t.value.gstate.CTM)}}return console.log("shadingType = "+n),this.core.toGravit("error",["01"]),{type:"rgb",value:[0,0,255]}}return this.core.toGravit("error",["01"]),{type:"rgb",value:[0,0,255]}}if("CIEBasedABC"==e[0].value){var Le=this.CIEBasedABCToRGB(t[0],t[1],t[2],e[1].value);return gDevelopment&&console.log(Math.round(255*Le[0])+" "+Math.round(255*Le[1])+" "+Math.round(255*Le[2])),{type:"rgb",value:[Math.round(255*Le[0]),Math.round(255*Le[1]),Math.round(255*Le[2])]}}if("DeviceN"==e[0].value||"Separation"==e[0].value){var je="string"==typeof e[2].value?[e[2]]:e[2].value,Ee=e[3],Oe=this._getSeparationColorVal(je,Ee,t);return this._getGColor(je,Oe)}return this.core.toGravit("error",["01"]),{type:"rgb",value:[0,0,255]}},PSColor.prototype._optimizeStops=function(e){if(e.length>2){for(var t=[],o=0;o<e[0].color.value.length;++o)for(var a=e[0].color.value[o],r=a,n=1;n<e.length;++n){var l=e[n].color.value[o];l<a&&(a=l),l>r&&(r=l),t.push(Math.min(Math.max(Math.abs(r-a)/5,4),12))}return this._interpolate(e,0,t)}return e},PSColor.prototype._interpolate=function(e,t,o){if(e.length<=2||t>62)return e;var a,r=e[0],n=e[e.length-1],l=r.position,i=n.position;if(Math.abs(i-l)<=1e-4)return[r,n];for(var u=e.length-1,s=0;s<r.color.value.length;++s){a=r.color.value[s];for(var c=(n.color.value[s]-a)/(i-l),h=a-c*l,p=o[s],v=1;v<e.length-1;++v){var f=Math.abs(h+c*e[v].position-e[v].color.value[s]);(f>p||f==p&&v<u)&&(u=v,p=f)}}if(u<e.length-1){var d=this._interpolate(e.slice(0,u+1),t+1,o),y=this._interpolate(e.slice(u),t+1,o);return d.slice(0,d.length-1).concat(y)}return[r,n]},PSColor.prototype.hsvToRGB=function(e){var t,o=e[2]*e[1],a=e[0]/60,r=o*(1-Math.abs(a%2-1)),n=e[2]-o;return t=a<1?[o,r,0]:a<2?[r,o,0]:a<3?[0,o,r]:a<4?[0,r,o]:a<5?[r,0,o]:a<=6?[o,0,r]:[0,0,0],[this.round_clamp_byte(255*(t[0]+n)),this.round_clamp_byte(255*(t[1]+n)),this.round_clamp_byte(255*(t[2]+n))]},PSColor.prototype.CMYKToRGB=function(e){var t=e[3],o=1-Math.min(1,e[0]+t),a=1-Math.min(1,e[1]+t),r=1-Math.min(1,e[2]+t);return[o,a,r=r>.1?r-.1:r]}}});